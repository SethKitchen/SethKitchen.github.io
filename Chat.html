<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />

     <!-- jQuery -->
    <script src="assets/js/jquery.min.js"></script>

    <!-- Firebase -->
    <script src="https://cdn.firebase.com/js/client/2.4.0/firebase.js"></script>

    <!-- Firechat -->
    <link rel="stylesheet" href="https://cdn.firebase.com/libs/firechat/2.0.1/firechat.min.css" />
    <script src="https://cdn.firebase.com/libs/firechat/2.0.1/firechat.min.js"></script>

    <!-- Custom CSS -->
    <style>
      #firechat-wrapper {
        height: 475px;
        max-width: 325px;
        padding: 10px;
        border: 1px solid #ccc;
        background-color: #fff;
        margin: 50px auto;
        text-align: center;
        -webkit-border-radius: 4px;
        -moz-border-radius: 4px;
        border-radius: 4px;
        -webkit-box-shadow: 0 5px 25px #666;
        -moz-box-shadow: 0 5px 25px #666;
        box-shadow: 0 5px 25px #666;
      }
    </style>
  </head>

  <body>
    <div id="firechat-wrapper"></div>

    <script type="text/javascript">
      try
      {
        var refChat = new Firebase("https://flickering-fire-5865.firebaseio.com/chat");
        var chat = new FirechatUI(refChat, document.getElementById("firechat-wrapper"));
        var ref=new Firebase("https://flickering-fire-5865.firebaseio.com/");
        var firstName="";
        var lastName="";

        // Create a callback which logs the current auth state
        function authDataCallback(authData) {
          
          if (authData) {
            userRef = ref.child("users").child(authData.uid);
            userRef.once("value", function (snap) {
              var userValue = snap.val();
              if (userValue==null) {
                return;
              }
              firstName=userValue.first_name;
              lastName=userValue.last_name;
              var nameCombo=firstName+ " "+lastName;
              chat.setUser(authData.uid, nameCombo);
            });
            
          }
          else
          {
            console.log("Not Logged in->Redirecting");
            //window.location.replace("Login.html");
          }
        }      
      }
      catch(ex)
      {
        console.log(ex);
        //window.location.replace("Login.html");
      }

      ref.onAuth(authDataCallback)
    </script>
  </body>
</html>
